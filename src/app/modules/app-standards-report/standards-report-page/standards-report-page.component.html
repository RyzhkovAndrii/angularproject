<div class="container-fluid">
  <div class="row mt-2 mb-0">
    <div class="col-3"></div>
    <div class="col-6 align-self-center" style="border-bottom: 1px solid #ddd">
      <form [formGroup]="dateForm">
        <div class="form-row align-items-center">
          <div class="col-5">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text">начало:</div>
              </div>
              <input type="date" class="form-control form-control-sm" formControlName="fromDate" max="{{now}}"
                [ngClass]="{'is-invalid': dateForm.get('fromDate').invalid || dateRangeError}">
            </div>
          </div>
          <div class="col-5">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text">окончание:</div>
              </div>
              <input type="date" class="form-control form-control-sm" formControlName="toDate" max="{{now}}" [ngClass]="{'is-invalid': dateForm.get('toDate').invalid || dateRangeError}">
            </div>
          </div>
          <div class="col-2">
            <button (click)="changeDate()" [disabled]="dateForm.invalid" class="btn btn-outline-dark btn-sm mb-2">Изменить
              период</button>
          </div>
        </div>
      </form>
    </div>
    <div class="col-3"></div>
  </div>
  <div id="page-name" class="row text-center sticky-top mt-0">
    <div class="col-12 align-self-center">
      <span class="align-middle">
        Отчёт о выполнении нормативов за период с
        <u>{{ from | moment: 'DD.MM.YY' }}</u> по <u>{{ to | moment: 'DD.MM.YY' }}</u>
      </span>
    </div>
  </div>
  <div class="row" *ngIf="reportsTable">
    <div class="col-1"></div>
    <div class="col-10">
      <table class="table table-bordered table-striped table-sm table-fit table-hover" #table>
        <thead>
          <tr>
            <th class="table-header" style="vertical-align: middle" rowspan=2 #th1>Наименование продукции</th>
            <th class="table-header" colspan=2 #th2>Использовано рулонов</th>
            <th class="table-header" colspan=2 #th3>Количество произведенной продукции</th>
            <th class="table-header" colspan=2 #th4>Отклонение</th>
            <th class="table-header" style="white-space: normal;" rowspan=2 #th5>Расчетный процент брака</th>
          </tr>
          <tr>
            <th class="table-header" #th6>Наименование рулона</th>
            <th class="table-header" #th7>Количество</th>
            <th class="table-header" #th8>Плановое по нормативам</th>
            <th class="table-header" #th9>Фактическое</th>
            <th class="table-header" #th10>Абсолютное</th>
            <th class="table-header" #th11>Относительное</th>
          </tr>
          <tr style="height: 0.2rem;"></tr>
        </thead>
        <tbody>
          <tr *ngFor="let tableRow of reportsTable">
            <td>
              <app-product-name [productType]="tableRow.product"></app-product-name>
            </td>
            <td>
              <div *ngFor="let roll of tableRow.report.rolls" class="row" class="m-0 p-0">
                <div class="col-12">
                  <app-roll-name *ngIf="roll" [rollType]="getRollType(roll.rollTypeId)"></app-roll-name>
                </div>
              </div>
            </td>
            <td>
              <div *ngFor="let roll of tableRow.report.rolls" class="row" class="m-0 p-0">
                <div class="col-12"> {{ roll.amount }} </div>
              </div>
            </td>
            <td *ngIf="tableRow.report.productPlanAmount !== null">{{ tableRow.report.productPlanAmount | exponent }}</td>
            <td *ngIf="tableRow.report.productPlanAmount === null">
              <span>НОРМАТИВ ОТСУТСТВУЕТ</span>
            </td>
            <td>{{ tableRow.report.productActualAmount | exponent }}</td>
            <td *ngIf="tableRow.report.productPlanAmount !== null">{{ getDeviation(tableRow.report) | exponent }}</td>
            <td *ngIf="tableRow.report.productPlanAmount === null"> - </td>
            <td *ngIf="tableRow.report.productPlanAmount"> {{ getDeviationInPercent(tableRow.report) }}% </td>
            <td *ngIf="!tableRow.report.productPlanAmount"> - </td>
            <td *ngIf="tableRow.report.productPlanAmount"> {{ getDefectPercent(tableRow) }}% </td>
            <td *ngIf="!tableRow.report.productPlanAmount"> - </td>
          </tr>
          <tr style="height: 0.2rem;"></tr>
          <tr>
            <td colspan=2><strong>Всего за период</strong></td>
            <td><strong>{{ totalReport.rolls[0].amount }}</strong></td>
            <td><strong>{{ totalReport.productPlanAmount | exponent }}</strong></td>
            <td><strong>{{ totalReport.productActualAmount | exponent }}</strong></td>
            <td><strong>{{ getDeviation(totalReport) | exponent }}</strong></td>
            <td *ngIf="totalReport.productPlanAmount"><strong>{{ getDeviationInPercent(totalReport)}}%</strong></td>
            <td *ngIf="!totalReport.productPlanAmount"><strong> - </strong></td>
            <td *ngIf="totalDefect !== null"><strong>{{totalDefect}}%</strong></td>
            <td *ngIf="totalDefect === null"><strong> - </strong></td>
          </tr>
        </tbody>
      </table>
      <table class="table-bordered table-striped table-sm table-no-wrap" id="header-fixed-table" *ngIf="!hideFixedHeader" [width]="table.offsetWidth" [style.left.px]="fixedHeaderLeftPosition">
        <thead>
          <tr>
            <th class="table-header" rowspan=2 [width]="th1.offsetWidth">Наименование продукции</th>
            <th class="table-header" colspan=2 [width]="th2.offsetWidth">Использовано рулонов</th>
            <th class="table-header" colspan=2 [width]="th3.offsetWidth">Количество произведенной продукции</th>
            <th class="table-header" colspan=2 [width]="th4.offsetWidth">Отклонение</th>
            <th class="table-header" style="white-space: normal;" rowspan=2 [width]="th5.offsetWidth">Расчетный процент брака</th>
          </tr>
          <tr>
            <th class="table-header" [width]="th6.offsetWidth">Наименование рулона</th>
            <th class="table-header" [width]="th7.offsetWidth">Количество</th>
            <th class="table-header" [width]="th8.offsetWidth">Плановое по нормативам</th>
            <th class="table-header" [width]="th9.offsetWidth">Фактическое</th>
            <th class="table-header" [width]="th10.offsetWidth">Абсолютное</th>
            <th class="table-header" [width]="th11.offsetWidth">Относительное</th>
          </tr>
          <tr style="height: 0.2rem;"></tr>
        </thead>
      </table>
    </div>
    <div class="col-1"></div>
  </div>
</div>